<script>
    window.PlutoniumBehaviors = window.PlutoniumBehaviors || {};
    PlutoniumBehaviors.CmBehavior = {
        properties: {
            sectionDisplay: {
                type: Boolean,
                notify: true,
                value: false
            },
            actionsDisplay: {
                type: Boolean,
                notify: true,
                value: false,
                observer: 'showActions'
            },
            name: {
                type: String,
                notify: true
            },
            title: {
                type: String,
                notify: true
            },
            data: {
                type: String,
                notify: true
            },
            inlineEditor: {
                type: Boolean,
                notify: true,
                value: false
            },
            _edited: {
                type: Boolean,
                notify: true,
                value: false
            },
            dialogId: {
                type: String,
                notify: true
            }
        },
//        listeners: {
//            'show-editor': 'onShowEditor',
//            'on-remove-section': 'onRemoveSection',
//            'on-add-section': 'onAddSection',
//            'actionContainer.on-embed-video': 'onEmbedVideo',
//            'actionContainer.onEmbedImage': 'onEmbedImage',
//            'onEmbedLink': 'onEmbedLink',
//            'onHovered': 'onHovered',
//            'onUnhovered': 'onUnhovered',
//            'onMoveUpSection': 'onMoveUpSection',
//            'onMoveDownSection': 'onMoveDownSection'
//        },
        ready: function () {
            this.customStyle['--plutonium-cm-field-display'] = 'inline-block';
            console.log('PLUTONIUM-CM-FAB ---------------');
            console.log('\tDialog id: ' + this.dialogId);
            console.log('\tName: ' + this.name);
            console.log('\tInline: ' + this.inlineEditor);
            console.log('--------------------------------');
            console.log('plutonium-field[' + this.name + '] is ready.');
            console.log('\tstate: ' + (this.inlineEditor === true ? 'inline' : 'dialog') + ', ' + (this._edited === true ? 'editor' : 'preview'));
    
    },
        onRemoveSection: function () {
            console.log('Remove field[' + this.name + ']');
            this.fire('remove', {
                name: this.name
            });
        },
        onShowEditor: function (model) {
            this._edited = true;
            this.data = model;
            if (this.inlineEditor === false) {
                console.log('Open field[' + this.name + '] editor in a dialog.');
//                Polymer.dom(this).parentNode.parentNode.$$('#' + this.dialogId).open();
                
                document.querySelector('#' + this.dialogId).open();
            } else {
                console.log('Show field[' + this.name + '] editor inline.');
            }
        },
        applyModel: function () {
            this._edited = false;
            this.fire('applyModel', {
                key: this.name,
                model: this.data
            });
            console.log('Show preview.');
        },
        onHovered: function () {
            this.actionsDisplay = true;
            this.showActions();
//            console.log('hovered (' + this.getComputedStyleValue('--plutonium-cm-actions-display') + ')');
        },
        onUnhovered: function () {
            this.actionsDisplay = false;
            this.showActions();
//            console.log('unhovered (' + this.getComputedStyleValue('--plutonium-cm-actions-display') + ')');
        },
        showActions: function (value) {
            this.customStyle['--plutonium-cm-actions-display'] = (this.actionsDisplay ? 'inline-block' : 'none') + ' !important';
            this.updateStyles();
        },
        onAddSection: function () {
            console.log('Add section after field[' + Polymer.dom(this).parentNode.parentNode.name + ']');
            this.fire('create', {
                name: this.name,
                type: 'plutonium-cm-editor-text'
            });
        },
        onEmbedVideo: function () {
            console.log('Embed video to after field[' + this.name + ']');
            this.fire('create', {
                name: this.name,
                type: 'plutonium-cm-editor-video'
            });
        },
        onEmbedImage: function () {
            console.log('Embed image to after field[' + this.name + ']');
            this.fire('create', {
                name: this.name,
                type: 'plutonium-cm-editor-image'
            });
        },
        onEmbedLink: function () {
            console.log('Embed link to after field[' + this.name + ']');
            this.fire('create', {
                name: this.name,
                type: 'plutonium-cm-editor-link'
            });
        },
        onMoveUpSection: function () {
            console.log('Move up field[' + this.name + ']');
            this.fire('moveupsection', {
                name: this.name
            });
        },
        onMoveDownSection: function () {
            console.log('Move down field[' + this.name + ']');
            this.fire('movedownsection', {
                name: this.name
            });
        }
    };
</script>